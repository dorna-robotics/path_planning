
import numpy as np
import os 
import time
import path_planning
from path_planning import Planner
import json
import scipy
# Define a shape dict (box example)
scene = []
load = []
gripper = []
import numpy as np

import dorna2.pose

col_boxes = [{'pose': [157.5, -24.87, 43.66, 0.0, 0.0, 0.0], 'scale': [771.0, 122.4, 73.6]}, {'pose': [158.2, 91.3, 44.1, 0.0, 0.0, 0.0], 'scale': [771.0, 111.1, 74.6]}, {'pose': [0.0, 0.0, 3.5, 0.0, 0.0, 0.0], 'scale': [500.0, 250.0, 7.0]}, {'pose': [0.0, -250.0, 3.5, 0.0, 0.0, 0.0], 'scale': [500.0, 250.0, 7.0]}, {'pose': [500.0, 0.0, 3.5, 0.0, 0.0, 0.0], 'scale': [500.0, 250.0, 7.0]}, {'pose': [500.0, -250.0, 3.5, 0.0, 0.0, 0.0], 'scale': [500.0, 250.0, 7.0]}, {'pose': [712.5, 87.5, 10.24, 0.0, 0.0, 90.0], 'scale': [66.0, 66.0, 5.95]}, {'pose': [712.5, 87.5, 84.82, 0.0, 0.0, 90.0], 'scale': [27.0, 27.0, 152.51]}, {'pose': [688.93, 87.5, 159.0, 0.0, 0.0, 90.0], 'scale': [53.92, 75.07, 5.95]}, {'pose': [666.5, 87.5, 133.767, 180.0, 1.4473103847089727e-14, 7.793604506119439e-15], 'scale': [46.87, 46.87, 56.52]}, {'pose': [666.5, 87.5, 104.358, 180.0, 1.4473103847089727e-14, 7.793604506119439e-15], 'scale': [21.74, 21.74, 26.21]}, {'pose': [712.5, 12.5, 10.24, 0.0, 0.0, 90.0], 'scale': [66.0, 66.0, 5.95]}, {'pose': [712.5, 12.5, 84.82, 0.0, 0.0, 90.0], 'scale': [27.0, 27.0, 152.51]}, {'pose': [688.93, 12.500000000000002, 159.0, 0.0, 0.0, 90.0], 'scale': [53.92, 75.07, 5.95]}, {'pose': [666.5, 12.500000000000004, 158.1718, 180.0, 1.4473103847089727e-14, 7.793604506119439e-15], 'scale': [45.0, 45.0, 8.66]}, {'pose': [666.5, 12.500000000000002, 135.0, 180.0, 1.4473103847089727e-14, 7.793604506119439e-15], 'scale': [12.57, 44.33, 37.19]}, {'pose': [666.5, 12.499999999999996, 84.769, 180.0, 1.4473103847089727e-14, 7.793604506119439e-15], 'scale': [12.74, 12.74, 69.42]}, {'pose': [666.5, 12.499999999999993, 41.81999999999999, 180.0, 1.4473103847089727e-14, 7.793604506119439e-15], 'scale': [22.65, 22.65, 19.68]}, {'pose': [712.5, -112.5, 10.24, 0.0, 0.0, 90.0], 'scale': [66.0, 66.0, 5.95]}, {'pose': [712.5, -112.5, 84.82, 0.0, 0.0, 90.0], 'scale': [27.0, 27.0, 152.51]}, {'pose': [688.93, -112.5, 159.0, 0.0, 0.0, 90.0], 'scale': [53.92, 75.07, 5.95]}, {'pose': [726.94, -312.5, 125.89, 0.0, 0.0, 180.0], 'scale': [25.9, 25.9, 241.39]}, {'pose': [637.5, -312.5, 11.2, 0.0, 0.0, 180.0], 'scale': [155.6, 103.5, 9.25]}, {'pose': [637.5, -312.5, 86.8, 0.0, 0.0, 180.0], 'scale': [155.6, 103.5, 9.25]}, {'pose': [637.5, -312.5, 163.6, 0.0, 0.0, 180.0], 'scale': [155.6, 103.5, 9.25]}, {'pose': [637.5, -312.5, 238.4, 0.0, 0.0, 180.0], 'scale': [155.6, 103.5, 9.25]}, {'pose': [637.5, -312.5, 100.4, 0.0, 0.0, 180.0], 'scale': [131.0, 87.4, 28.28]}, {'pose': [637.5, -312.5, 176.4, 0.0, 0.0, 180.0], 'scale': [131.0, 87.4, 28.28]}, {'pose': [637.5, -312.5, 252.4, 0.0, 0.0, 180.0], 'scale': [131.0, 87.4, 28.28]}, {'pose': [-87.5, -262.5, 8.84, 0.0, 0.0, 180.0], 'scale': [115.74, 40.02, 12.813]}, {'pose': [-87.5, -251.0, 42.5, 0.0, 0.0, 180.0], 'scale': [74.67, 131.5, 74.97]}, {'pose': [-87.5, -275.88, 82.61, 4.2178683647936675e-15, 68.88301782571615, 166.2983158520316], 'scale': [77.27, 59.59, 77.89]}, {'pose': [-87.50000000000001, -325.33, 128.75, 4.2178683647936675e-15, 68.88301782571615, 166.2983158520316], 'scale': [215.14, 215.14, 71.75]}, {'pose': [312.5, -287.5, 15.34, 0.0, 0.0, 90.0], 'scale': [130.5, 88.6, 8.66]}, {'pose': [137.5, -312.5, 11.15, 0.0, 0.0, 90.0], 'scale': [67.93, 67.93, 10.724]}, {'pose': [137.5, -312.5, 46.19, 0.0, 0.0, 90.0], 'scale': [44.7, 44.7, 71.38]}, {'pose': [137.5, -312.5, 97.15, 0.0, 0.0, 90.0], 'scale': [18.3, 18.3, 33.56]}, {'pose': [137.5, -274.01, 107.24, 0.0, 0.0, 90.0], 'scale': [93.62, 18.31, 11.25]}, {'pose': [137.5, -237.1, 77.72, 0.0, 0.0, 90.0], 'scale': [8.67, 8.67, 83.1]}, {'pose': [137.5, -237.5, 30.85, 0.0, 0.0, 180.0], 'scale': [76.1, 70.7, 63.21]}]

col_boxes2 = [{'pose': [-1.1368683772161603e-13, 0.0, 55.71999999999997, 0.0, 0.0, 0.0], 'scale': [44.51, 73.53, 46.06]}, {'pose': [48.09999999999991, 49.69000000000001, 81.84, 0.0, 0.0, 0.0], 'scale': [125.44, 37.44, 22.57]}, {'pose': [48.10000000000002, -49.69, 81.83999999999997, 0.0, 0.0, 0.0], 'scale': [125.44, 37.44, 22.57]}]


for box in col_boxes:
    scene.append(Planner.create_cube( box["pose"],[box["scale"][0],box["scale"][1],box["scale"][2]] ))

for box in col_boxes2:
    gripper.append(Planner.create_cube( box["pose"],[box["scale"][0],box["scale"][1],box["scale"][2]] ))


planner = Planner(    
    scene = scene,
    load          = [],
    tool          = [0,0,10, 0,0,0],
    gripper        = gripper,
    base_in_world =  [-12.5, -25.0, 89.0, 0.0, 0.0, 0.0],
    frame_in_world= [0.0,0.0,0.0, 0,0,0],
    aux_dir       = [ [0.001,0,0], [0,0,0] ],
    aux_limit = [[-500, 500], [-1, 1]]
    )


print(planner.base_in_world)
start_time = time.perf_counter()

res = planner.plan([-21.852067332900504, 32.30982675723658, -90.20252149234886, 0.0, -38.107305264887714, -35.852067332900504, 239.0],
    [-21.852067332900504, 34.30982675723658, -90.20252149234886, 0.0, -38.107305264887714, -35.852067332900504, 239.0])

end_time = time.perf_counter()
execution_time = end_time - start_time

print(f"Operation finished in {execution_time:.4f} seconds")

print(res)



print(planner.check_collision([0,-30,0,0,0,0,235]))

